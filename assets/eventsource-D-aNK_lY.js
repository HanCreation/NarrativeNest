import{g as X,a as Z}from"./index-_QzNVu8V.js";import{_ as k}from"./__vite-browser-external-DFe-p4yY.js";function D(n,e){for(var t=0;t<e.length;t++){const f=e[t];if(typeof f!="string"&&!Array.isArray(f)){for(const d in f)if(d!=="default"&&!(d in n)){const i=Object.getOwnPropertyDescriptor(f,d);i&&Object.defineProperty(n,d,i.get?i:{enumerable:!0,get:()=>f[d]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}const j=X(k);var H=j.parse,ee=j,te=j,re=j,ne=j,ae=["pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","secureProtocol","servername","checkServerIdentity"],J=[239,187,191],se=58,oe=32,S=10,ie=13,Y=1024*256,fe=/^(cookie|authorization)$/i;function ue(n){return J.every(function(e,t){return n[t]===e})}function s(n,e){var t=s.CONNECTING,f=e&&e.headers,d=!1;Object.defineProperty(this,"readyState",{get:function(){return t}}),Object.defineProperty(this,"url",{get:function(){return n}});var i=this;i.reconnectInterval=1e3,i.connectionInProgress=!1;function _(a){t!==s.CLOSED&&(t=s.CONNECTING,y("error",new P("error",{message:a})),A&&(n=A,A=null,d=!1),setTimeout(function(){t!==s.CONNECTING||i.connectionInProgress||(i.connectionInProgress=!0,M())},i.reconnectInterval))}var l,N="";f&&f["Last-Event-ID"]&&(N=f["Last-Event-ID"],delete f["Last-Event-ID"]);var G=!1,x="",I="",A=null;function M(){var a=H(n),c=a.protocol==="https:";if(a.headers={"Cache-Control":"no-cache",Accept:"text/event-stream"},N&&(a.headers["Last-Event-ID"]=N),f){var p=d?ce(f):f;for(var g in p){var w=p[g];w&&(a.headers[g]=w)}}a.rejectUnauthorized=!(e&&!e.rejectUnauthorized),e&&e.createConnection!==void 0&&(a.createConnection=e.createConnection);var T=e&&e.proxy;if(T){var v=H(e.proxy);c=v.protocol==="https:",a.protocol=c?"https:":"http:",a.path=n,a.headers.Host=a.host,a.hostname=v.hostname,a.host=v.host,a.port=v.port}if(e&&e.https){for(var m in e.https)if(ae.indexOf(m)!==-1){var U=e.https[m];U!==void 0&&(a[m]=U)}}e&&e.withCredentials!==void 0&&(a.withCredentials=e.withCredentials),l=(c?te:re).request(a,function(r){if(i.connectionInProgress=!1,r.statusCode===500||r.statusCode===502||r.statusCode===503||r.statusCode===504){y("error",new P("error",{status:r.statusCode,message:r.statusMessage})),_();return}if(r.statusCode===301||r.statusCode===302||r.statusCode===307){var E=r.headers.location;if(!E){y("error",new P("error",{status:r.statusCode,message:r.statusMessage}));return}var V=new URL(n).origin,W=new URL(E).origin;d=V!==W,r.statusCode===307&&(A=n),n=E,process.nextTick(M);return}if(r.statusCode!==200)return y("error",new P("error",{status:r.statusCode,message:r.statusMessage})),i.close();t=s.OPEN,r.on("close",function(){r.removeAllListeners("close"),r.removeAllListeners("end"),_()}),r.on("end",function(){r.removeAllListeners("close"),r.removeAllListeners("end"),_()}),y("open",new P("open"));var o,$,F=0,q=-1,L=0,h=0;r.on("data",function(C){o?(C.length>o.length-h&&(L=o.length*2+C.length,L>Y&&(L=o.length+C.length+Y),$=Buffer.alloc(L),o.copy($,0,0,h),o=$),C.copy(o,h),h+=C.length):(o=C,ue(o)&&(o=o.slice(J.length)),h=o.length);for(var u=0,z=h;u<z;){G&&(o[u]===S&&++u,G=!1);for(var b=-1,B=q,R,O=F;b<0&&O<z;++O)R=o[O],R===se?B<0&&(B=O-u):R===ie?(G=!0,b=O-u):R===S&&(b=O-u);if(b<0){F=z-u,q=B;break}else F=0,q=-1;Q(o,u,B,b),u+=b+1}u===z?(o=void 0,h=0):u>0&&(o=o.slice(u,h),h=o.length)})}),l.on("error",function(r){i.connectionInProgress=!1,_(r.message)}),l.setNoDelay&&l.setNoDelay(!0),l.end()}M();function y(){i.listeners(arguments[0]).length>0&&i.emit.apply(i,arguments)}this._close=function(){t!==s.CLOSED&&(t=s.CLOSED,l.abort&&l.abort(),l.xhr&&l.xhr.abort&&l.xhr.abort())};function Q(a,c,p,g){if(g===0){if(x.length>0){var w=I||"message";y(w,new le(w,{data:x.slice(0,-1),lastEventId:N,origin:new URL(n).origin})),x=""}I=void 0}else if(p>0){var T=p<0,v=0,m=a.slice(c,c+(T?g:p)).toString();T?v=g:a[c+p+1]!==oe?v=p+1:v=p+2,c+=v;var U=g-v,r=a.slice(c,c+U).toString();if(m==="data")x+=r+`
`;else if(m==="event")I=r;else if(m==="id")N=r;else if(m==="retry"){var E=parseInt(r,10);Number.isNaN(E)||(i.reconnectInterval=E)}}}}var K=s;ne.inherits(s,ee.EventEmitter);s.prototype.constructor=s;["open","error","message"].forEach(function(n){Object.defineProperty(s.prototype,"on"+n,{get:function(){var t=this.listeners(n)[0];return t?t._listener?t._listener:t:void 0},set:function(t){this.removeAllListeners(n),this.addEventListener(n,t)}})});Object.defineProperty(s,"CONNECTING",{enumerable:!0,value:0});Object.defineProperty(s,"OPEN",{enumerable:!0,value:1});Object.defineProperty(s,"CLOSED",{enumerable:!0,value:2});s.prototype.CONNECTING=0;s.prototype.OPEN=1;s.prototype.CLOSED=2;s.prototype.close=function(){this._close()};s.prototype.addEventListener=function(e,t){typeof t=="function"&&(t._listener=t,this.on(e,t))};s.prototype.dispatchEvent=function(e){if(!e.type)throw new Error("UNSPECIFIED_EVENT_TYPE_ERR");this.emit(e.type,e.detail)};s.prototype.removeEventListener=function(e,t){typeof t=="function"&&(t._listener=void 0,this.removeListener(e,t))};function P(n,e){if(Object.defineProperty(this,"type",{writable:!1,value:n,enumerable:!0}),e)for(var t in e)e.hasOwnProperty(t)&&Object.defineProperty(this,t,{writable:!1,value:e[t],enumerable:!0})}function le(n,e){Object.defineProperty(this,"type",{writable:!1,value:n,enumerable:!0});for(var t in e)e.hasOwnProperty(t)&&Object.defineProperty(this,t,{writable:!1,value:e[t],enumerable:!0})}function ce(n){var e={};for(var t in n)fe.test(t)||(e[t]=n[t]);return e}const ve=Z(K),he=D({__proto__:null,default:ve},[K]);export{he as e};
